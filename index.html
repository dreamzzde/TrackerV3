<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MISSION 74 - Smart Tracker</title>
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1614/1614392.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .card { background: white; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .btn-black { background-color: #000; color: white; transition: all 0.1s; }
        .btn-black:active { transform: scale(0.98); opacity: 0.8; }
        input, select { border: 1px solid #e2e8f0 !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .training-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="p-4 pb-24 max-w-md mx-auto">

    <header class="flex justify-between items-center mb-4 bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
        <div>
            <h1 class="text-2xl font-black text-gray-800 tracking-tighter italic">MISSION<span class="text-green-600">74</span></h1>
            <p id="feedback" class="text-[10px] font-bold text-blue-500 uppercase italic">Ready to work?</p>
        </div>
        <div class="text-right">
            <div id="score" class="text-3xl font-black text-green-600 leading-none">0%</div>
            <p id="ampelStatus" class="text-[10px] uppercase font-bold tracking-widest mt-1 italic">Check...</p>
        </div>
    </header>

    <div id="scheduleContainer" class="card p-4 mb-4 bg-white border border-gray-100">
        <p class="text-[10px] font-black text-gray-400 uppercase mb-2 tracking-widest italic">Trainings-Schedule</p>
        <div class="flex justify-between gap-1">
            <div id="day-1" class="flex-grow py-2 rounded-xl text-center text-[10px] font-black border uppercase">Mo</div>
            <div id="day-2" class="flex-grow py-2 rounded-xl text-center text-[10px] font-black border uppercase bg-gray-50 text-gray-300 border-transparent">Di</div>
            <div id="day-3" class="flex-grow py-2 rounded-xl text-center text-[10px] font-black border uppercase">Mi</div>
            <div id="day-4" class="flex-grow py-2 rounded-xl text-center text-[10px] font-black border uppercase bg-gray-50 text-gray-300 border-transparent">Do</div>
            <div id="day-5" class="flex-grow py-2 rounded-xl text-center text-[10px] font-black border uppercase">Fr</div>
            <div id="day-6" class="flex-grow py-2 rounded-xl text-center text-[10px] font-black border uppercase bg-gray-50 text-gray-300 border-transparent">Sa</div>
            <div id="day-0" class="flex-grow py-2 rounded-xl text-center text-[10px] font-black border uppercase bg-gray-50 text-gray-300 border-transparent">So</div>
        </div>
        <div id="workoutTodayWarning" class="hidden mt-3 p-2 rounded-xl bg-purple-100 border border-purple-200 text-purple-700 text-[10px] font-black uppercase text-center training-pulse italic">
            ğŸ”¥ Heute ist Trainingstag! Gib alles.
        </div>
    </div>

    <div id="warningArea"></div>

    <div class="card p-4 mb-4">
        <div class="flex items-center justify-between mb-1">
            <label id="dayNameLabel" class="font-black text-gray-800 text-sm uppercase italic">Wird geladen...</label>
            <input type="date" id="dateInput" onchange="updateDayDisplay(); render();" class="rounded-xl p-1 text-xs bg-gray-50 border-none font-bold text-gray-500">
        </div>
        <p id="fullDateLabel" class="text-[10px] text-gray-400 font-bold uppercase tracking-widest"></p>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-6">
        <button onclick="toggleOverlay('workoutOverlay')" class="bg-purple-600 text-white p-4 rounded-2xl text-[11px] font-black shadow-lg italic uppercase">ğŸ‹ï¸ Training</button>
        <button onclick="toggleOverlay('mealOverlay')" class="bg-blue-600 text-white p-4 rounded-2xl text-[11px] font-black shadow-lg italic uppercase">ğŸ’¡ Mahlzeiten</button>
    </div>

    <div id="workoutOverlay" class="fixed inset-0 bg-black/95 hidden z-50 p-6 overflow-y-auto" onclick="toggleOverlay('workoutOverlay')">
        <div class="bg-white rounded-[32px] p-6 w-full max-w-sm mx-auto shadow-2xl" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-black uppercase italic text-purple-600">ğŸ‹ï¸ Trainingsplan</h2>
                <button onclick="toggleOverlay('workoutOverlay')" class="text-3xl text-gray-300">&times;</button>
            </div>
            <div class="space-y-6 text-sm">
                <div>
                    <p class="font-black text-purple-600 text-xs uppercase mb-1">ğŸ¦µ Beine</p>
                    <p class="font-bold text-gray-800 italic">Goblet Squats: <span class="text-gray-500 font-normal">4x 12-20 (3s runter)</span></p>
                    <p class="font-bold text-gray-800 mt-1 italic">Romanian Deadlifts: <span class="text-gray-500 font-normal">3x 12-15</span></p>
                </div>
                <div>
                    <p class="font-black text-blue-600 text-xs uppercase mb-1">ğŸ’ª OberkÃ¶rper</p>
                    <p class="font-bold text-gray-800 italic">Floor Press (KH): <span class="text-gray-500 font-normal">4x 10-15</span></p>
                    <p class="font-bold text-gray-800 mt-1 italic">Einarmiges Rudern: <span class="text-gray-500 font-normal">4x 12-15 je Seite</span></p>
                </div>
                <div>
                    <p class="font-black text-orange-600 text-xs uppercase mb-1">ğŸ§ Core & Schultern</p>
                    <p class="font-bold text-gray-800 italic">SchulterdrÃ¼cken: <span class="text-gray-500 font-normal">3x 10-15</span></p>
                    <p class="font-bold text-gray-800 mt-1 italic">Plank: <span class="text-gray-500 font-normal">3x 45-75 Sek</span></p>
                </div>
                <button onclick="logSpecial('ğŸ”¥ Workout erledigt', 'TRAINING ğŸ‹ï¸')" class="w-full bg-purple-600 text-white py-5 rounded-2xl font-black uppercase shadow-lg mt-4 tracking-widest">Training loggen</button>
            </div>
        </div>
    </div>

    <div id="mealOverlay" class="fixed inset-0 bg-black/95 hidden z-50 p-6 overflow-y-auto" onclick="toggleOverlay('mealOverlay')">
        <div class="bg-white rounded-[32px] p-6 w-full max-w-sm mx-auto shadow-2xl" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-black uppercase italic text-blue-600">ğŸ’¡ Mahlzeiten Guide</h2>
                <button onclick="toggleOverlay('mealOverlay')" class="text-3xl text-gray-300">&times;</button>
            </div>
            <div class="space-y-4">
                <div class="p-3 bg-blue-50 rounded-2xl border border-blue-100">
                    <p class="text-[10px] font-black text-blue-600 uppercase mb-1">FrÃ¼hstÃ¼ck</p>
                    <button onclick="logSpecial('Magerquark, Beeren & NÃ¼sse', 'FrÃ¼hstÃ¼ck')" class="text-left w-full text-sm font-bold text-gray-800 py-1 border-b border-blue-100">Quark & Beeren (+)</button>
                    <button onclick="logSpecial('RÃ¼hrei mit viel GemÃ¼se', 'FrÃ¼hstÃ¼ck')" class="text-left w-full text-sm font-bold text-gray-800 py-1 mt-1">RÃ¼hrei & GemÃ¼se (+)</button>
                </div>
                <div class="p-4 bg-green-50 rounded-2xl border border-green-100">
                    <p class="text-[10px] font-black text-green-600 uppercase mb-1">Mittagessen</p>
                    <button onclick="logSpecial('GroÃŸer Salat mit Protein', 'Mittag')" class="text-left w-full text-sm font-bold text-gray-800">ğŸ¥— GroÃŸer Salat (+)</button>
                    <button onclick="logSpecial('Veggie-Bowl mit wenig Reis', 'Mittag')" class="text-left w-full text-sm font-bold text-gray-800 border-t border-green-200 mt-1 pt-1">ğŸ¥£ Veggie-Bowl (+)</button>
                </div>
                <div class="p-4 bg-orange-50 rounded-2xl border border-orange-100">
                    <p class="text-[10px] font-black text-orange-600 uppercase mb-1">Abendessen</p>
                    <button onclick="logSpecial('GemÃ¼se & Lachs/Tofu', 'Abend')" class="text-left w-full text-sm font-bold text-gray-800">ğŸ”¥ GemÃ¼se & Protein (+)</button>
                    <button onclick="logSpecial('GemÃ¼sepfanne pur', 'Abend')" class="text-left w-full text-sm font-bold text-gray-800 border-t border-orange-200 mt-1 pt-1">ğŸ³ GemÃ¼sepfanne pur (+)</button>
                </div>
            </div>
        </div>
    </div>

    <div class="card p-6 mb-6 border-t-8 border-black shadow-xl">
        <input id="foodInput" type="text" oninput="autoCheck()" placeholder="Was isst du?" class="w-full text-xl font-bold placeholder-gray-300 border-none focus:ring-0 p-0 mb-4 outline-none">
        <div class="grid grid-cols-2 gap-3 mb-4">
            <select id="mealInput" class="bg-gray-50 p-3 rounded-xl font-bold text-gray-600 text-sm">
                <option>FrÃ¼hstÃ¼ck</option><option>Mittag</option><option>Abend</option><option>Snack</option>
            </select>
            <select id="tagInput" class="bg-gray-50 p-3 rounded-xl font-bold text-gray-600 text-sm">
                <option value="Normal">Normal âœ…</option><option value="Cheat">Cheat âŒ</option>
            </select>
        </div>
        <button onclick="saveFood()" class="w-full btn-black py-5 rounded-2xl font-black text-lg uppercase shadow-lg tracking-widest">Eintragen</button>
    </div>

    <div id="foodList" class="space-y-3 mb-8"></div>

    <script>
        const qs = (id) => document.getElementById(id);
        const goodWords = ['salat', 'gemÃ¼se', 'hÃ¤hnchen', 'quark', 'ei', 'fisch', 'brokkoli', 'apfel', 'beeren', 'lachs', 'tofu', 'reis', 'pfanne', 'bowl', 'mandeln', 'steak', 'pute'];
        const badWords = ['pizza', 'burger', 'bier', 'cola', 'chips', 'schokolade', 'nudeln', 'zucker', 'eis', 'dÃ¶ner'];

        function getLocalDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        window.onload = function() {
            qs('dateInput').value = getLocalDate();
            updateSchedule();
            updateDayDisplay();
            render();
        };

        function updateSchedule() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0=So, 1=Mo, 2=Di, 3=Mi, 4=Do, 5=Fr, 6=Sa
            const trainingDays = [1, 3, 5]; // Mo, Mi, Fr

            trainingDays.forEach(d => {
                const el = qs('day-' + d);
                el.classList.add('bg-purple-50', 'text-purple-600', 'border-purple-200');
            });

            // Aktuellen Tag hervorheben
            const currentEl = qs('day-' + dayOfWeek);
            currentEl.classList.add('ring-2', 'ring-black', 'ring-offset-2');

            // Wenn heute Trainingstag ist
            if (trainingDays.includes(dayOfWeek)) {
                qs('workoutTodayWarning').classList.remove('hidden');
            }
        }

        function updateDayDisplay() {
            const inputVal = qs('dateInput').value;
            if (!inputVal) return;
            const parts = inputVal.split('-');
            const selectedDate = new Date(parts[0], parts[1] - 1, parts[2]);
            const now = new Date();
            now.setHours(0,0,0,0);
            selectedDate.setHours(0,0,0,0);
            const dayName = selectedDate.toLocaleDateString('de-DE', { weekday: 'long' });
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            const fullDate = selectedDate.toLocaleDateString('de-DE', options);
            if (selectedDate.getTime() === now.getTime()) {
                qs('dayNameLabel').innerText = "Heute (" + dayName + ")";
                qs('dayNameLabel').className = "font-black text-green-600 text-sm uppercase italic";
            } else {
                qs('dayNameLabel').innerText = dayName;
                qs('dayNameLabel').className = "font-black text-gray-800 text-sm uppercase italic";
            }
            qs('fullDateLabel').innerText = fullDate;
        }

        function toggleOverlay(id) { qs(id).classList.toggle('hidden'); }

        function autoCheck() {
            const input = qs('foodInput').value.toLowerCase();
            const tagInput = qs('tagInput');
            const feedback = qs('feedback');
            if (!input) { feedback.innerText = "Ready to work?"; feedback.className = "text-[10px] font-bold text-blue-500 uppercase italic"; return; }
            let isGood = goodWords.some(word => input.includes(word));
            let isBad = badWords.some(word => input.includes(word));
            if (isGood) { tagInput.value = "Normal"; feedback.className = "text-[10px] font-bold text-green-600 uppercase italic"; feedback.innerText = "Top Wahl!"; }
            else if (isBad) { tagInput.value = "Cheat"; feedback.className = "text-[10px] font-bold text-red-600 uppercase italic"; feedback.innerText = "Vorsicht!"; }
        }

        function getData(date) { return JSON.parse(localStorage.getItem('f_' + date) || '[]'); }

        function logSpecial(name, category) {
            const date = qs('dateInput').value;
            const data = getData(date);
            data.unshift({ food: name, meal: category, tag: "Normal", time: new Date().toLocaleTimeString('de-DE').slice(0,5), timestamp: Date.now() });
            localStorage.setItem('f_' + date, JSON.stringify(data));
            qs('mealOverlay').classList.add('hidden');
            qs('workoutOverlay').classList.add('hidden');
            render();
        }

        function saveFood() {
            const food = qs('foodInput').value.trim();
            if (!food) return;
            const date = qs('dateInput').value;
            const data = getData(date);
            data.unshift({ food, meal: qs('mealInput').value, tag: qs('tagInput').value, time: new Date().toLocaleTimeString('de-DE').slice(0,5), timestamp: Date.now() });
            localStorage.setItem('f_' + date, JSON.stringify(data));
            qs('foodInput').value = '';
            render();
        }

        function render() {
            const date = qs('dateInput').value;
            const data = getData(date);
            const list = qs('foodList');
            list.innerHTML = '';
            let cheats = 0;
            data.forEach((item, index) => {
                const isWorkout = item.meal.includes("TRAINING");
                if (item.tag === 'Cheat') cheats++;
                const borderColor = isWorkout ? 'border-purple-500' : (item.tag === 'Normal' ? 'border-green-500' : 'border-red-500');
                const bgColor = isWorkout ? 'bg-purple-50' : 'bg-white';
                const div = document.createElement('div');
                div.className = `card p-4 flex items-center justify-between border-l-8 ${borderColor} ${bgColor} mb-2 shadow-sm`;
                div.innerHTML = `<div><p class="text-[10px] font-bold text-gray-400 uppercase">${item.time} â€¢ ${item.meal}</p><p class="font-bold text-gray-800 text-sm">${item.food}</p></div><button onclick="remove(${index})" class="text-gray-300 text-xl px-2">&times;</button>`;
                list.appendChild(div);
            });
            const score = Math.max(0, 100 - (cheats * 25));
            qs('score').innerText = score + "%";
            qs('ampelStatus').innerText = score >= 75 ? "ğŸŸ¢ Gut" : "ğŸ”´ Kritisch";
            const hour = new Date().getHours();
            const warningArea = qs('warningArea');
            warningArea.innerHTML = '';
            if (hour >= 20 && date === getLocalDate()) {
                warningArea.innerHTML = `<div class="bg-red-100 p-4 rounded-2xl mb-4 text-red-700 text-[11px] font-bold border border-red-200 animate-pulse text-center uppercase tracking-widest">â° Essensfenster geschlossen</div>`;
            }
        }

        function remove(index) {
            const date = qs('dateInput').value;
            const data = getData(date);
            data.splice(index, 1);
            localStorage.setItem('f_' + date, JSON.stringify(data));
            render();
        }
    </script>
</body>
</html>